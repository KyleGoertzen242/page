<!DOCTYPE html>
<html lang="en">
<head>
	<script src="https://www.paypal.com/sdk/js?client-id=Acjbbhu_UmM-H4DiGwIkB5Elz-hJdFJBk0E2P01ZKb2lcw6CUmJlTZ69Iel4jJqMqkN0WjdHVWMdDOzB&currency=USD&components=buttons&enable-funding=card"></script>
	<script>(function(s){s.dataset.zone='10542007',s.src='https://nap5k.com/tag.min.js'})([document.documentElement, document.body].filter(Boolean).pop().appendChild(document.createElement('script')))</script>
	<script src="https://quge5.com/88/tag.min.js" data-zone="206215" async data-cfasync="false"></script>
	<meta charset="UTF-8">
    <title>Bank</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
	<link rel="stylesheet" href="page.css">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
#ad-container,
#second-ad-container,
#third-ad-container,
#fourth-ad-container,
#fifth-ad-container,
#sixth-ad-container,
#seventh-ad-container {
    position: relative;
    width: 140px;
    height: 300px;
}

#ad-container img,
#second-ad-container img,
#third-ad-container img,
#fourth-ad-container img,
#fifth-ad-container img,
#sixth-ad-container img,
#seventh-ad-container img {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 140px;
    height: 300px;
    transform: translate(-50%, -50%);
    opacity: 0;
    transition: opacity 0.2s ease-in-out;
}

#ad-container img.active,
#second-ad-container img.secondactive,
#third-ad-container img.thirdactive,
#fourth-ad-container img.fourthactive,
#fifth-ad-container img.fifthactive,
#sixth-ad-container img.sixthactive,
#seventh-ad-container img.seventhactive {
    opacity: 1;
    z-index: 1;
}

#ads {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.message {
    margin-top: 10px;
    font-size: 14px;
    color: #333333;
}

.colort {
    margin-top: 20px;
    text-align: left;
    width: 100%;
    background-color: #fafafa;
    border-radius: 12px;
    padding: 16px;
    border: 1px solid #e5e5e5;
}
    </style>
</head>
<body>
<header id="fcf-header">
  <div class="fcf-left">
    <img src="favicon.ico" class="fcf-logo">
    <span class="fcf-title">FriendCodeForum</span>
  </div>

  <nav class="fcf-nav">
    <a href="/">Home</a>
	<a href="/policy.html">Terms and Conditions and Policies</a>
  </nav>
</header>

<h2>Enter Amount to Pay</h2>

<input 
type="number" 
id="amount" 
placeholder="Enter amount (e.g. 100)" 
min="1"
step="1.0"
style="transform: scale(0.8); transform-origin: top left;"
>

<br><br>

<div id="paypal-button-container" style="transform: scale(0.8); transform-origin: top left;"></div>

<script>
paypal.Buttons({

  createOrder: function(data, actions) {

	let amount = document.getElementById("amount").value;

	if (!amount || amount <= 0) {
	  alert("Please enter a valid amount.");
	  return;
	}

	return actions.order.create({
	  purchase_units: [{
		amount: {
		  value: parseFloat(amount).toFixed(2)
		}
	  }]
	});
  },

  onApprove: function(data, actions) {
	return actions.order.capture().then(function(details) {
	  alert("Payment completed successfully!");
	});
  },

  onError: function(err) {
	console.error(err);
	alert("An error occurred.");
  }

}).render('#paypal-button-container');
</script>
	
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyBrZTwbNcyZRIUaPXa1tuksDw3mwTI7E_o",
    authDomain: "friendcodeforum-fe84c.firebaseapp.com",
    projectId: "friendcodeforum-fe84c",
    storageBucket: "friendcodeforum-fe84c.firebasestorage.app",
    messagingSenderId: "134978263228",
    appId: "1:134978263228:web:5e25b25af65f088288d8b9"
  };

  // Initialize Firebase app
  const app = initializeApp(firebaseConfig);

  // Initialize Auth
  const auth = getAuth(app);

  // Auth state listener
  onAuthStateChanged(auth, user => {
    const currentPath = window.location.pathname;
    
    // Only redirect if user is NOT logged in and not already on the login page
    if (!user && currentPath !== '/index.html') {
      window.location.replace("/index.html"); // safer than href
    }
  });
</script>



<button id="googleLogin">Sign in with Google</button>
<script type="module">
	import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
	import { getAuth, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
	import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";
	const firebaseConfig = {
		apiKey: "AIzaSyBrZTwbNcyZRIUaPXa1tuksDw3mwTI7E_o",
		authDomain: "friendcodeforum-fe84c.firebaseapp.com",
		projectId: "friendcodeforum-fe84c",
		storageBucket: "friendcodeforum-fe84c.firebasestorage.app",
		messagingSenderId: "134978263228",
		appId: "1:134978263228:web:5e25b25af65f088288d8b9"
	};

	const app = initializeApp(firebaseConfig);
	const auth = getAuth(app);
	const db = getFirestore(app);
	const provider = new GoogleAuthProvider();

	document.getElementById("googleLogin").onclick = async () => {
	  try {
	    const result = await signInWithPopup(auth, provider);
	    const user = result.user;
	    const uid = user.uid;
	
	    const userDocRef = doc(db, "users", uid);
	    const userSnap = await getDoc(userDocRef);
	
	    let coin = 0;
	
	    if (userSnap.exists()) {
	      coin = userSnap.data().coins;
	    }
	
	    const messageDiv = document.getElementById("message");
	    messageDiv.style.color = "green";
	    messageDiv.textContent = `Welcome, ${user.displayName}! You have ${coin} coins.`;
	
	  } catch (err) {
	    alert("Error: " + err.message);
	  }
	};

</script>
	
<div id="message"></div>
	
<button id="logout">Logout</button>

<script type="module">
	import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";

	const auth = getAuth();

	document.getElementById("logout").onclick = () => {
		signOut(auth).then(() => {
			window.location.href = "/";
		});
	};
</script>

<canvas 
    id="game" 
    width="800" 
    height="400" 
    style="
        border: 5px solid #fff;
        border-radius: 20px;
        box-shadow: 0 0 40px rgba(255,255,255,0.6), 0 0 20px #aaa inset;
        background: linear-gradient(to bottom, #f9f9f9, #e0e0e0);
        display: block;
        margin: 50px auto;
    ">
</canvas>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
import {
  getFirestore, doc, getDoc, setDoc, updateDoc, collection, onSnapshot
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBrZTwbNcyZRIUaPXa1tuksDw3mwTI7E_o",
  authDomain: "friendcodeforum-fe84c.firebaseapp.com",
  projectId: "friendcodeforum-fe84c",
  storageBucket: "friendcodeforum-fe84c.firebasestorage.app",
  messagingSenderId: "134978263228",
  appId: "1:134978263228:web:5e25b25af65f088288d8b9"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const canvas = document.getElementById("game");
let accountLoaded = false;
let isAuthReady = false;
let isSavingBlocked = false;
const ctx = canvas.getContext("2d");

/* ================= MOBILE INPUT ================= */

// On-screen buttons
const buttons = {
  left:  { x: 20,  y: canvas.height - 80, w: 60, h: 60, key: "arrowleft",  label: "â—€" },
  right: { x: 100, y: canvas.height - 80, w: 60, h: 60, key: "arrowright", label: "â–¶" },
  fish:  { x: canvas.width - 80, y: canvas.height - 80, w: 60, h: 60, key: "f", label: "F" }
};

function handleTouch(e, down) {
  const rect = canvas.getBoundingClientRect();

  for (const t of e.touches) {
    const x = t.clientX - rect.left;
    const y = t.clientY - rect.top;

    Object.values(buttons).forEach(b => {
      if (
        x > b.x && x < b.x + b.w &&
        y > b.y && y < b.y + b.h
      ) {
        keys[b.key] = down;
      }
    });
  }
}

// Touch listeners
canvas.addEventListener("touchstart", e => {
  e.preventDefault();
  handleTouch(e, true);
});

// On touchend, **clear all button keys** so character stops moving
canvas.addEventListener("touchend", e => {
  e.preventDefault();
  Object.values(buttons).forEach(b => keys[b.key] = false);
});



const keys = {};
window.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
window.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

const sprites = {
  idle: new Image(),
  walk1: new Image(),
  walk2: new Image(),
  fishing: new Image()
};
sprites.idle.src = "idle.png";
sprites.walk1.src = "walk1.png";
sprites.walk2.src = "walk2.png";
sprites.fishing.src = "walk1.png";

const itemSprites = {
  hat: new Image(),
  blue_hat: new Image(),
  rod: new Image(),
  fish: new Image(),
  jousting_helmet: new Image()
};
itemSprites.hat.src = "hat.png";
itemSprites.blue_hat.src = "blue_hat.png";
itemSprites.rod.src = "rod.png";
itemSprites.fish.src = "fish.png";
itemSprites.jousting_helmet.src = "jousting_helmet_maplestory_warrior.png";

const hatOffsets = {
  hat: { x: -10, y: -20, w: 25, h: 40 },
  blue_hat: { x: -10, y: -20, w: 25, h: 40 },
  jousting_helmet: {x:5, y:5, w:65, h:45}
};

const handOffsets = {
  rod: {
    right: { x: -40, y: 40, w: 40, h: 40, rot: -0.2 },
    left: { x: 10, y: 40, w: 40, h: 40, rot: -0.2 }
  }
};

// ------------------ PLAYER ------------------
let player = {
  x: 200, y: 270, width: 55, height: 84, speed: 4, direction: "right",
  inventory: [], equipped: { hat: null, hand: null },
  animationFrame: 0, animationTimer: 0, isMoving: false,
  isFishing: false, fishingTimer: 0, fishingDuration: 0,
  casting: false, castTimer: 0, castDuration: 30, exp: 0,
  collectedItems: [] // <-- track world item pickups
};

const expPopups = []; // {x, y, text, alpha}

// ------------------ WORLD ------------------
const waterZone = { x: 400, y: 300, width: 200, height: 80 };
const items = [
  { id: "blue_hat", name: "Blue Hat", x: 650, y: 300, size: 20 },
  { id: "rod", name: "Fishing Rod", x: 300, y: 300, size: 20 },
  { id: "jousting_helmet", name: "Jousting Helmet", x: 620, y: 300, size: 30 }
];

const hasItem = id => player.inventory.some(i => i.id === id);

// ------------------ INVENTORY ------------------
function addItem(id, name) {
  if (id === "fish") {
    const existing = player.inventory.find(i => i.id === "fish");
    if (existing) existing.qty = (existing.qty || 1) + 1;
    else player.inventory.push({ id, name, qty: 1 });
  } else {
    if (!player.inventory.some(i => i.id === id)) player.inventory.push({ id, name });
  }
  updateInventoryUI();
  updateEquippedUI();
  if (auth?.currentUser) saveInventory(auth.currentUser.uid);
}

function toggleEquip(item) {
  if (item.id === "fish") return;
  const slot = item.id === "rod" ? "hand" : "hat";
  player.equipped[slot] = player.equipped[slot]?.id === item.id ? null : item;
  updateEquippedUI();
  if (auth?.currentUser) saveInventory(auth.currentUser.uid);
}

function updateInventoryUI() {
  const invDiv = document.getElementById("inventoryList");
  invDiv.innerHTML = "";
  player.inventory.forEach(item => {
    const btn = document.createElement("button");
    btn.style.display = "flex";
    btn.style.alignItems = "center";
    btn.style.marginBottom = "6px";

    const img = document.createElement("img");
    img.src = itemSprites[item.id].src;
    img.width = 24; img.height = 24; img.style.marginRight = "6px";
    btn.appendChild(img);

    const text = document.createElement("span");
    text.textContent = item.id === "fish" ? `${item.name} x${item.qty || 1}` : item.name;
    btn.appendChild(text);

    btn.onclick = () => toggleEquip(item);
    invDiv.appendChild(btn);
  });
}

function updateEquippedUI() {
  const eqDiv = document.getElementById("equippedList");
  if (!eqDiv) return;
  eqDiv.innerHTML = "";
  Object.entries(player.equipped).forEach(([slot, item]) => {
    const div = document.createElement("div");
    div.textContent = item ? `${slot}: ${item.name}` : `${slot}: none`;
    eqDiv.appendChild(div);
  });
}

// ------------------ LEADERBOARD ------------------
function updateLeaderboardUI(data) {
  const lbDiv = document.getElementById("leaderboard");
  if (!lbDiv) return;
  lbDiv.innerHTML = "<h3>Leaderboard</h3>";
  data.forEach((u, i) => {
    const div = document.createElement("div");
    div.textContent = `${i + 1}. ${u.name}: ${u.exp} EXP`;
    lbDiv.appendChild(div);
  });
}

// ------------------ DATABASE ------------------
async function loadInventory(uid) {
  const snap = await getDoc(doc(db, "users", uid));
  if (!snap.exists()) return;
  const data = snap.data();
  player.inventory = data.inventory || [];
  player.equipped = data.equipped || { hat: null, hand: null };
  player.exp = data.exp || 0;
  player.collectedItems = data.collectedItems || [];
  updateInventoryUI();
  updateEquippedUI();
  accountLoaded = true;	
}

async function saveInventory(uid) {
  if (!isAuthReady || isSavingBlocked) return;
  await updateDoc(doc(db, "users", uid), {
    inventory: player.inventory,
    equipped: player.equipped,
    exp: player.exp,
    collectedItems: player.collectedItems
  });
}

// ------------------ AUTH ------------------
onAuthStateChanged(auth, async user => {
  // --- BLOCK saving / EXP until ready ---
  isSavingBlocked = true;
  isAuthReady = false;
  accountLoaded = false;

  // --- LOAD OR RESET PLAYER ---
  if (user) {
    await loadInventory(user.uid); // wait until Firestore finishes loading
  } else {
    player.inventory = [];
    player.equipped = { hat: null, hand: null };
    player.exp = 0;
    player.collectedItems = [];
    updateInventoryUI();
    updateEquippedUI();
  }

  // --- AUTH READY ---
  isAuthReady = true;
  accountLoaded = true;
  isSavingBlocked = false;

  // --- LEADERBOARD ---
  onSnapshot(collection(db, "users"), snapshot => {
    const leaderboard = [];

    snapshot.forEach(doc => {
      const d = doc.data();
      const displayName = d.email ? d.email.split("@")[0] : "Unknown";
      leaderboard.push({ name: displayName, exp: d.exp || 0 });
    });

    // Include local player if not logged in
    if (!auth.currentUser) leaderboard.push({ name: "Unknown", exp: player.exp });

    leaderboard.sort((a, b) => b.exp - a.exp);
    updateLeaderboardUI(leaderboard.slice(0, 10));
  });
});



// ------------------ EXP ------------------
function gainExp(amount) {
  if (!accountLoaded || !isAuthReady) return;
  player.exp += amount;
  expPopups.push({ x: player.x + player.width / 2, y: player.y, text: `+${amount} EXP`, alpha: 1 });
  if (auth?.currentUser) saveInventory(auth.currentUser.uid);
}

// ------------------ GAME LOOP ------------------
function update() {
  if (!accountLoaded) return;
  player.isMoving = false;

  // FISHING
  if (player.isFishing) {
    if (player.casting) {
      player.castTimer++;
      if (player.castTimer >= player.castDuration) {
        player.casting = false;
        player.fishingTimer = 0;
        player.fishingDuration = Math.floor(Math.random() * 10 + 1) * 60;
      }
      return;
    }

    player.fishingTimer++;
    if (player.fishingTimer >= player.fishingDuration) {
      player.isFishing = false;
      player.fishingTimer = 0;
      addItem("fish", "Fish");
      gainExp(100);
    }
    return;
  }

  // MOVEMENT
  if (keys.arrowright) { player.x += player.speed; player.direction = "right"; player.isMoving = true; }
  if (keys.arrowleft)  { player.x -= player.speed; player.direction = "left"; player.isMoving = true; }

  if (player.isMoving) {
    player.animationTimer++;
    if (player.animationTimer >= 10) { 
      player.animationFrame = (player.animationFrame + 1) % 2; 
      player.animationTimer = 0; 
    }
  } else { 
    player.animationFrame = 0; 
    player.animationTimer = 0; 
  }

  // CASTING
  if (keys.f &&
      player.equipped.hand?.id === "rod" &&
      player.x + player.width > waterZone.x &&
      player.x < waterZone.x + waterZone.width &&
      player.y + player.height > waterZone.y &&
      player.y < waterZone.y + waterZone.height) {
    player.isFishing = true;
    player.casting = true;
    player.castTimer = 0;
  }

  // PICKUP ITEMS
  items.forEach(item => {
	if (!isAuthReady) return;
    if (player.collectedItems.includes(item.id)) return; // skip already collected
    const hit = player.x < item.x + item.size &&
                player.x + player.width > item.x &&
                player.y < item.y + item.size &&
                player.y + player.height > item.y;
    if (hit) {
      player.collectedItems.push(item.id); // track collected
      addItem(item.id, item.name);
      if (auth?.currentUser) saveInventory(auth.currentUser.uid);
    }
  });

  player.x = Math.max(0, Math.min(canvas.width - player.width, player.x));
}

// ------------------ DRAW ------------------
function drawBackground() {
    // --- Sky ---
    ctx.fillStyle = "#87CEEB"; // light blue
    ctx.fillRect(0, 0, canvas.width, 300);

    // --- Grass ---
    const grassGradient = ctx.createLinearGradient(0, 300, 0, canvas.height);
    grassGradient.addColorStop(0, "#7ec850");
    grassGradient.addColorStop(1, "#4c9c2f");
    ctx.fillStyle = grassGradient;
    ctx.fillRect(0, 300, canvas.width, 100);

	// --- Buildings (instead of trees) ---
	const buildings = [
		{x: 50, y: 200, w: 60, h: 100, color: "#8B0000"},
		{x: 150, y: 180, w: 80, h: 120, color: "#A52A2A"},
		{x: 250, y: 210, w: 50, h: 90, color: "#B22222"},
		{x: 550, y: 190, w: 70, h: 110, color: "#800000"},
		{x: 650, y: 200, w: 60, h: 100, color: "#9B2B2B"}
	];

	buildings.forEach(b => {
		// building body
		ctx.fillStyle = b.color;
		ctx.fillRect(b.x, b.y, b.w, b.h);

		// windows
		ctx.fillStyle = "#FFF8DC";
		const windowWidth = 10;
		const windowHeight = 12;
		const paddingX = 3;
		const paddingY = 3;
		const spacingX = 5;
		const spacingY = 8;

		let rows = Math.floor((b.h - 2 * paddingY) / (windowHeight + spacingY));
		let cols = Math.floor((b.w - 2 * paddingX) / (windowWidth + spacingX));

		for (let i = 0; i < rows; i++) {
			for (let j = 0; j < cols; j++) {
				const winX = b.x + paddingX + j * (windowWidth + spacingX);
				const winY = b.y + paddingY + i * (windowHeight + spacingY);

				// Ensure window fits inside the building
				if (winX + windowWidth <= b.x + b.w && winY + windowHeight <= b.y + b.h) {
					ctx.fillRect(winX, winY, windowWidth, windowHeight);
				}
			}
		}
	});

    // --- Realistic Japanese Shrine ---
    const shrineX = 350;
    const shrineY = 220; // level with grass
    const shrineWidth = 120;
    const shrineHeight = 80;

    // base
    ctx.fillStyle = "#8B4513";
    ctx.fillRect(shrineX, shrineY, shrineWidth, shrineHeight);

    // pillars
    ctx.strokeStyle = "#5c0f0f";
    ctx.lineWidth = 4;
    ctx.beginPath();
    ctx.moveTo(shrineX + 10, shrineY);
    ctx.lineTo(shrineX + 10, shrineY + shrineHeight);
    ctx.moveTo(shrineX + shrineWidth - 10, shrineY);
    ctx.lineTo(shrineX + shrineWidth - 10, shrineY + shrineHeight);
    ctx.stroke();

    // roof
    ctx.fillStyle = "#b22222";
    ctx.beginPath();
    ctx.moveTo(shrineX - 20, shrineY);
    ctx.quadraticCurveTo(shrineX + shrineWidth / 2, shrineY - 40, shrineX + shrineWidth + 20, shrineY);
    ctx.lineTo(shrineX + shrineWidth + 20, shrineY + 10);
    ctx.quadraticCurveTo(shrineX + shrineWidth / 2, shrineY - 30, shrineX - 20, shrineY + 10);
    ctx.closePath();
    ctx.fill();

    // door
    ctx.fillStyle = "#5c0f0f";
    ctx.fillRect(shrineX + 45, shrineY + 30, 30, 50);

    // --- Banner ---
    const bannerWidth = 200;
    const bannerHeight = 40;
    const bannerX = shrineX - 40;
    const bannerY = shrineY - 50;

    ctx.fillStyle = "#FFDDE0"; // cream-pink
    ctx.beginPath();
    const waveAmplitude = 5;
    const waveLength = 50;
    for (let i = 0; i <= bannerWidth; i++) {
        const yOffset = Math.sin((i / waveLength) * Math.PI * 2) * waveAmplitude;
        if (i === 0) ctx.moveTo(bannerX + i, bannerY + yOffset);
        else ctx.lineTo(bannerX + i, bannerY + yOffset);
    }
    for (let i = bannerWidth; i >= 0; i--) {
        const yOffset = Math.sin((i / waveLength) * Math.PI * 2) * waveAmplitude + bannerHeight;
        ctx.lineTo(bannerX + i, bannerY + yOffset);
    }
    ctx.closePath();
    ctx.fill();
    ctx.lineWidth = 1;
    ctx.strokeStyle = "#000";
    ctx.stroke();

    // Banner text
    ctx.fillStyle = "#000";
    ctx.font = "20px Arial";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillText("Welcome", bannerX + bannerWidth / 2, bannerY + bannerHeight / 2);
}

function drawPlayer() {
  const sprite = player.isFishing ? sprites.fishing :
                 player.isMoving ? (player.animationFrame === 0 ? sprites.walk1 : sprites.walk2) : sprites.idle;

  ctx.save();
  const facingLeft = player.direction === "right";

  const drawHat = () => {
    const hat = player.equipped.hat; if (!hat) return;
    const off = hatOffsets[hat.id]; if (!off) return;
	if (facingLeft) {
		ctx.drawImage(itemSprites[hat.id], -off.x, off.y, off.w, off.h);
	} else {
		if (hat.id === 'jousting_helmet') {
			ctx.drawImage(itemSprites[hat.id], off.x-65, off.y, off.w, off.h);
		}
		else {
			ctx.drawImage(itemSprites[hat.id], off.x-30, off.y, off.w, off.h);
		}
	}
  };

  const drawHandItem = () => {
    const hand = player.equipped.hand; if (!hand) return;
    const off = handOffsets[hand.id]; if (!off) return;
    const data = facingLeft ? off.left : off.right;

    ctx.save();
    ctx.translate(data.x, data.y);
    let rot = data.rot;
    if (player.casting) {
      const progress = player.castTimer / player.castDuration;
      rot += (facingLeft ? -1 : 1) * Math.sin(progress * Math.PI) * 0.5;
    }
    ctx.rotate(rot);
    ctx.drawImage(itemSprites[hand.id], 0, 0, data.w, data.h);
    ctx.restore();
  };

  if (facingLeft) {
    ctx.translate(player.x + player.width, player.y);
    ctx.scale(-1, 1);
    ctx.drawImage(sprite, 0, 0, player.width, player.height);
    ctx.save(); ctx.translate(player.width, 0); ctx.scale(-1, 1); drawHat(); drawHandItem(); ctx.restore();
  } else {
    ctx.drawImage(sprite, player.x, player.y, player.width, player.height);
    ctx.save(); ctx.translate(player.x, player.y); ctx.scale(-1, 1); drawHat(); drawHandItem(); ctx.restore();
  }

  ctx.restore();
}

function drawButtons() {
  ctx.globalAlpha = 0.7;

  Object.values(buttons).forEach(b => {
    ctx.fillStyle = "#000";
    ctx.fillRect(b.x, b.y, b.w, b.h);

    ctx.fillStyle = "#fff";
    ctx.font = "28px Arial";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillText(b.label, b.x + b.w / 2, b.y + b.h / 2);
  });

  ctx.globalAlpha = 1;
}



function drawItems() { 
  items.forEach(item => { 
    if (!player.collectedItems.includes(item.id)) ctx.drawImage(itemSprites[item.id], item.x, item.y, item.size, item.size); 
  }); 
}

function drawWater() { ctx.fillStyle = "#3aa0ff"; ctx.fillRect(waterZone.x, waterZone.y, waterZone.width, waterZone.height); }

function drawUI() {
  if (!accountLoaded) {
    ctx.fillText("Loading...", 100, 30);
    return;
  }
  ctx.fillStyle = "red";
  ctx.font = "18px Arial";
  ctx.fillText(`EXP: ${player.exp}`, 60, 30);

  // EXP popups
  for (let i = expPopups.length - 1; i >= 0; i--) {
    const p = expPopups[i];
    ctx.globalAlpha = p.alpha;
    ctx.fillText(p.text, p.x, p.y);
    ctx.globalAlpha = 1;
    p.y -= 0.7;
    p.alpha -= 0.02;
    if (p.alpha <= 0) expPopups.splice(i, 1);
  }
}

// ------------------ LOOP ------------------
function loop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  drawBackground();
  update();
  drawWater();
  drawItems();
  drawPlayer();
  drawUI();
  drawButtons();
  requestAnimationFrame(loop);
}
loop();



</script>

<div style="display:flex; gap:20px;">
  <div style="width:220px; border-right:1px solid #ccc;">
    <h3>Chats</h3>
    <div id="chatList"></div>
  </div>

  <div style="flex:1;">
    <h3 id="chatTitle">Select a chat</h3>

    <div id="messages"
         style="height:300px; overflow-y:auto; border:1px solid #ccc; padding:5px;">
    </div>

    <br>

    <input id="toEmail" placeholder="User email" />
    <br><br>

    <textarea id="messageText" placeholder="Type message"></textarea>
    <br><br>

    <button id="sendBtn">Send</button>
  </div>
</div>

<div id="leaderboard">
  <h3>Leaderboard</h3>
</div>

<div id="ui">
  <div id="inventoryBox">
    <h4>Inventory (click to equip)</h4>
    <div id="inventoryList"></div>
  </div>

  <div id="equippedBox">
    <h4>Equipped</h4>
    <div id="equippedList"></div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
import {
  getFirestore,
  doc,
  collection,
  getDoc,
  getDocs,
  setDoc,
  addDoc,
  query,
  where,
  orderBy,
  onSnapshot,
  serverTimestamp
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBrZTwbNcyZRIUaPXa1tuksDw3mwTI7E_o",
  authDomain: "friendcodeforum-fe84c.firebaseapp.com",
  projectId: "friendcodeforum-fe84c",
  storageBucket: "friendcodeforum-fe84c.firebasestorage.app",
  messagingSenderId: "134978263228",
  appId: "1:134978263228:web:5e25b25af65f088288d8b9"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

async function ensureUserDoc(user) {
  const userRef = doc(db, "users", user.uid);
  const snap = await getDoc(userRef);
  if (!snap.exists()) {
    await setDoc(userRef, {
      email: user.email,
      coins: 0
    });
  }
}

async function getUidByEmail(email) {
  const normalizedEmail = email.trim().toLowerCase();
  const usersRef = collection(db, "users");
  const q = query(usersRef, where("email", "==", normalizedEmail));
  const snap = await getDocs(q);
  if (!snap.empty) return snap.docs[0].id;

  const newUserRef = doc(usersRef);
  await setDoc(newUserRef, {
    email: normalizedEmail,
    coins: 0
  });
  return newUserRef.id;
}

function getChatId(uid1, uid2) {
  return [uid1, uid2].sort().join("__");
}

async function sendMessage() {
  const user = auth.currentUser;
  if (!user) return alert("You must be logged in");

  const toEmail = document.getElementById("toEmail").value.trim();
  const text = document.getElementById("messageText").value.trim();
  if (!toEmail || !text) return alert("Enter recipient email and message");

  try {
    const toUid = await getUidByEmail(toEmail);
    const chatId = getChatId(user.uid, toUid);

    await setDoc(doc(db, "chats", chatId), {
      users: [user.uid, toUid],
      lastMessage: text,
      updatedAt: serverTimestamp()
    }, { merge: true });

    await addDoc(collection(db, "chats", chatId, "messages"), {
      from: user.uid,
      fromEmail: user.email,
      text,
      createdAt: serverTimestamp()
    });

    document.getElementById("messageText").value = "";
  } catch (err) {
    console.error("Failed to send message:", err);
    alert("Failed to send message: " + err.message);
  }
}

function loadChats() {
  const user = auth.currentUser;
  if (!user) return;

  const chatsRef = collection(db, "chats");
  const q = query(chatsRef, where("users", "array-contains", user.uid), orderBy("updatedAt"));

  onSnapshot(q, async snapshot => {
    const list = document.getElementById("chatList");
    list.innerHTML = "";

    for (const docSnap of snapshot.docs) {
      const chat = docSnap.data();
      const otherUid = chat.users.find(u => u !== user.uid);

      let display = otherUid;
      try {
        const otherSnap = await getDoc(doc(db, "users", otherUid));
        if (otherSnap.exists()) display = otherSnap.data().email;
      } catch {}

      const div = document.createElement("div");
      div.textContent = display + " (" + (chat.lastMessage ?? "") + ")";
      div.style.cursor = "pointer";
      div.style.padding = "6px";
      div.style.borderBottom = "1px solid #ddd";

      div.onclick = () => {
        document.getElementById("chatTitle").textContent = display;
        loadMessages(docSnap.id);
      };

      list.appendChild(div);
    }
  });
}

function loadMessages(chatId) {
  const messagesRef = collection(db, "chats", chatId, "messages");
  const q = query(messagesRef, orderBy("createdAt"));

  onSnapshot(q, snapshot => {
    const box = document.getElementById("messages");
    box.innerHTML = "";

    snapshot.forEach(docSnap => {
      const msg = docSnap.data();
      const div = document.createElement("div");
      div.textContent = `${msg.fromEmail ?? msg.from}: ${msg.text}`;
      box.appendChild(div);
    });

    box.scrollTop = box.scrollHeight;
  });
}

document.getElementById("sendBtn").onclick = sendMessage;

onAuthStateChanged(auth, user => {
  if (user) {
    ensureUserDoc(user);
    loadChats();
  } else {
    document.getElementById("chatList").innerHTML = "";
    document.getElementById("messages").innerHTML = "";
    document.getElementById("chatTitle").textContent = "Select a chat";
  }
});
</script>

	
<div id="layout">
<div id="main-layout">
    <div id="ads">
        <div id="ad-container">
            <img src="image1.png" class="active" alt="Ad 1">
            <img src="image2.png" alt="Ad 2">
            <img src="image3.png" alt="Ad 3">
        </div>
        
        <script>
            const images = document.querySelectorAll('#ad-container img');
            let current = 0;
            
            setInterval(() => {
              images[current].classList.remove('active');
              current = (current + 1) % images.length;
              images[current].classList.add('active');
            }, 1000);
        </script>
        
        <div id="second-ad-container">
            <img src="image4.png" class="secondactive" alt="Ad 4">
            <img src="image5.png" alt="Ad 5">
        </div>
            
        <script>
            const secondimages = document.querySelectorAll('#second-ad-container img');
            let secondcurrent = 0;
        
            setInterval(() => {
                secondimages[secondcurrent].classList.remove('secondactive');
                secondcurrent = (secondcurrent + 1) % secondimages.length;
                secondimages[secondcurrent].classList.add('secondactive');
            }, 1000);
        </script>
        
        <div id="third-ad-container">
            <img src="image6.png" class="thirdactive" alt="Ad 6">
            <img src="image7.png" alt="Ad 7">
            <img src="image8.png" alt="Ad 8">
            <img src="image9.png" alt="Ad 9">
        </div>
            
        <script>
            const thirdimages = document.querySelectorAll('#third-ad-container img');
            let thirdcurrent = 0;
        
            setInterval(() => {
                thirdimages[thirdcurrent].classList.remove('thirdactive');
                thirdcurrent = (thirdcurrent + 1) % thirdimages.length;
                thirdimages[thirdcurrent].classList.add('thirdactive');
            }, 1000);
        </script>
        
        <div id="fourth-ad-container">
            <img src="image10.png" class="fourthactive" alt="Ad 10">
            <img src="image11.png" alt="Ad 11">
            <img src="image12.png" alt="Ad 12">
        </div>
            
        <script>
            const fourthimages = document.querySelectorAll('#fourth-ad-container img');
            let fourthcurrent = 0;
        
            setInterval(() => {
                fourthimages[fourthcurrent].classList.remove('fourthactive');
                fourthcurrent = (fourthcurrent + 1) % fourthimages.length;
                fourthimages[fourthcurrent].classList.add('fourthactive');
            }, 1000);
        </script>

        <div id="fifth-ad-container">
            <img src="image13.png" class="fifthactive" alt="Ad 13">
            <img src="image14.png" alt="Ad 14">
            <img src="image15.png" alt="Ad 15">
        </div>
            
        <script>
            const fifthimages = document.querySelectorAll('#fifth-ad-container img');
            let fifthcurrent = 0;
        
            setInterval(() => {
                fifthimages[fifthcurrent].classList.remove('fifthactive');
                fifthcurrent = (fifthcurrent + 1) % fifthimages.length;
                fifthimages[fifthcurrent].classList.add('fifthactive');
            }, 1000);
        </script>

		<div id="sixth-ad-container">
            <img src="image16.png" class="sixthactive" alt="Ad 16">
            <img src="image17.png" alt="Ad 17">
            <img src="image18.png" alt="Ad 18">
        </div>
            
        <script>
            const sixthimages = document.querySelectorAll('#sixth-ad-container img');
            let sixthcurrent = 0;
        
            setInterval(() => {
                sixthimages[sixthcurrent].classList.remove('sixthactive');
                sixthcurrent = (sixthcurrent + 1) % sixthimages.length;
                sixthimages[sixthcurrent].classList.add('sixthactive');
            }, 1000);
        </script>

		<div id="seventh-ad-container">
            <img src="Screenshot_20260117-180705.png" class="seventhactive" alt="Ad 19">
            <img src="Screenshot_20260117-180709.png" alt="Ad 20">
            <img src="Screenshot_20260117-180716.png" alt="Ad 21">
			<img src="Screenshot_20260117-180759.png" alt="Ad 22">
			<img src="Screenshot_20260117-180852.png" alt="Ad 23">
        </div>
        
        <script>
            const seventhimages = document.querySelectorAll('#seventh-ad-container img');
            let seventhcurrent = 0;
            
            setInterval(() => {
              seventhimages[seventhcurrent].classList.remove('seventhactive');
              seventhcurrent = (seventhcurrent + 1) % seventhimages.length;
              seventhimages[seventhcurrent].classList.add('seventhactive');
            }, 1000);
        </script>
    </div>

    <div id="textdiv">
		<a href="https://amzn.to/4n8RtbP" target="_blank" style="text-decoration: none; color: #E1306C; font-weight: bold; font-family: Arial, sans-serif;">
          https://amzn.to/4n8RtbP Amazon Associate's Link
        </a>
        
        <br>
		
        <a href="https://www.friendcodeforum.com/" target="_blank" style="text-decoration: none; color: #E1306C; font-weight: bold; font-family: Arial, sans-serif;">
          https://www.friendcodeforum.com/ Send e-transfer to kgoertzen14@gmail.com in Canada ðŸ‡¨ðŸ‡¦ 
        </a>
        
        <br>
		
        <a href="https://www.instagram.com/yugioholdhead/" target="_blank" style="text-decoration: none; color: #E1306C; font-weight: bold; font-family: Arial, sans-serif;">
          https://www.instagram.com/yugioholdhead/ YuGiOhOldHead Yu-Gi-Oh! Content and Auctions daily based out of France 
        </a>

		<br>
        
        <a href="https://ebay.us/m/X94yDQ/" target="_blank" style="text-decoration: none; color: #E1306C; font-weight: bold; font-family: Arial, sans-serif;">
          https://ebay.us/m/X94yDQ Link to Japanese_hobbyneeds eBay store for collectables<br>
            "Iâ€™m a seller based in Japan offering unique PokÃ©mon and Japanese cultural items.<br>
            As a lifelong fan, I specialize in vintage, rare, and local-only collectibles. <br>
            My shop features items you wonâ€™t easily find outside Japan. <br>
            All orders are securely packed and shipped via FedEx or Japan Post, with tracking. <br>
            I understand the importance of item condition and safe delivery, especially for collectors. <br>
            If a price doesnâ€™t work for you, feel free to send an offer. Many items are flexible. <br>
            Also, please watch items you like â€” we often send private discounts to watchers. <br>
            Customer satisfaction is very important. <br>
            If thereâ€™s ever an issue that would prevent you from leaving 5 stars, <br>
            please contact me first so I can help resolve it. <br>
            Thank you for visiting my store. <br>
            I hope you find something truly special and nostalgic from Japan! <br>
            Gifu Prefectural Public Safety Commission <br>Secondhand dealer number 531180002492 <br>
            K.Toru"
        </a>

        <br>
        
        <a href="https://ytmp3.cc/" target="_blank" style="text-decoration: none; color: #E1306C; font-weight: bold; font-family: Arial, sans-serif;">
          https://ytmp3.cc/ YT to MP3 Converter
        </a>

		<br>
        
        <a href="https://near-reality.com/" target="_blank" style="text-decoration: none; color: #E1306C; font-weight: bold; font-family: Arial, sans-serif;">
          https://near-reality.com/ NR Oldschool
        </a>
        
        <hr>
        <br>
        
        <div class="colort">
            <span>
                <br>
                ðŸ’°$500
            </span>    
        </div>
        
<pre><code>#=================================================================================================================================================== <br>
#Study-Only License
#
#Copyright (c) 2024-2026 KyleGoertzen242
#
#All rights reserved.
#
#This software is provided solely for educational and study purposes. <br>
    You may not use, copy, modify, merge, publish, distribute, sublicense, or sell copies of the Software. <br>
    The Software is not intended for production, commercial, or any other practical use.
#
#No permission is granted for any kind of use or redistribution of the Software beyond its intended study purpose. <br>
    The Software is provided "as is", without any warranty of any kind, either express or implied, <br>
    including but not limited to the warranties of merchantability, fitness for a particular purpose, <br>
    and noninfringement. In no event shall the authors or copyright holders be liable for any claims, <br>
    damages, or other liabilities, whether in an action of contract, tort, or otherwise, arising from, <br>
    out of, or in connection with the Software or the use or other dealings in the Software.
#
#By accessing or using this Software, you agree that you do so at your own risk. If you wish to use, <br>
    copy, or distribute this Software beyond study purposes, you must obtain explicit written permission from the copyright holder.
#
#Study-Only License
#
#Copyright (c) 2024-2026 KyleGoertzen242
#
#All rights reserved.
#
#This software is provided solely for educational and study purposes. <br>
    It is not intended for use in production environments, commercial applications, or any other practical usage.<br>
    The primary goal is to allow users to learn from or experiment with the code in a controlled environment.
#
#You may not use, copy, modify, merge, publish, distribute, sublicense, or sell copies of the Software. <br>
    Redistribution and use in any form, including modification or derivative works, are strictly prohibited. <br>
    The Software is not intended for any practical, commercial, or real-world deployment.
#
#The Software is provided "as is," with no warranties or guarantees of any kind, express or implied, <br>
    including but not limited to the warranties of merchantability, fitness for a particular purpose, <br>
    and noninfringement. In no event shall the authors or copyright holders be liable for any claims, <br>
    damages, or other liabilities arising from the use of the Software.
#
#By accessing or using this Software, you agree to do so at your own risk. <br>
    If you wish to use, copy, or distribute the Software for purposes other than study or educational purposes, <br>
    you must obtain explicit written permission from the copyright holder.
#
#Study-Only License
#
#Copyright (c) 2024-2026 KyleGoertzen242
#
#All rights reserved.
#
#This software is provided solely for educational, research, and study purposes. <br>
    It is not intended for use in production environments, commercial applications, or any other practical usage. <br>
    The software is meant as a learning resource, and by using it, you agree to do so solely for study and research. 
#
#You may not use, copy, modify, merge, publish, distribute, sublicense, or sell copies of the Software. <br>
    Redistribution and usage in any form, including modification or derivative works, are strictly prohibited. <br>
    The Software is not intended for any practical, commercial, or real-world deployment.
#
#**Purpose**: This code is shared as part of a study or research project and should not be used in production environments.<br>
    It is provided to allow users to explore and understand the concepts presented within it, but is not suitable for real-world applications.
#
#**No Liability**: The Software is provided "as is," without any warranty of any kind, either express or implied, <br>
    including but not limited to the warranties of merchantability, fitness for a particular purpose, and noninfringement. <br>
    In no event shall the authors or copyright holders be liable for any claims, damages, or other<br>
    liabilities arising from the use or misuse of the Software.
#
#**Use at Your Own Risk**: By accessing, using, or attempting to modify this software, <br>
    you agree that you are doing so at your own risk. You are fully responsible for any consequences,<br>
    errors, or damages that may arise from using this software.
#
#**Restrictions on Use**: If you wish to use, copy, or distribute this Software for any purpose beyond educational, <br>
    research, or study, you must first obtain explicit written permission from the copyright holder. <br>
    No rights are granted beyond those specified in this license.
#
#This license applies to the entire repository, including the code, documentation, and any other associated files.
#=================================================================================================================================================== <br>
    
import pyautogui
import cv2
import numpy as np
import random
import time
import math

def detect_image(template_image_paths):
    best_match_location = None
    best_match_confidence = 0
    
    for template_image_path in template_image_paths:
        template = pyautogui.locateOnScreen(template_image_path)
        
        if template is not None and template[2] * template[3] > best_match_confidence:
            best_match_location = template
            best_match_confidence = template[2] * template[3]

    if best_match_location is not None:
        return best_match_location.left, best_match_location.top, best_match_location.width, best_match_location.height
    else:
        return None

def draw_box(image, x, y, w, h):
    cv2.rectangle(image, (x, y), (x + w, y + h), (0, 255, 0), 2)

def ease_out_quad(t, b, c, d):
    t /= d
    return -c * t*(t-2) + b

def click_element(location):
    x, y, w, h = location
    target_x = x + w // 2 + random.randint(-1, 2)
    target_y = y + h // 2 + random.randint(-1, 2)
    
    duration = random.uniform(6, 12)
    steps = int(duration)  # 60 steps per second
    
    for i in range(steps):
        t = i / steps
        pyautogui.moveTo(
            ease_out_quad(t, pyautogui.position().x, target_x - pyautogui.position().x, 1),
            ease_out_quad(t, pyautogui.position().y, target_y - pyautogui.position().y, 1),
            duration=0
        )
        time.sleep(1/60)
    pyautogui.click(button='left')

def main():
    template_image_spell = ['spell.png']
    template_image_item = ['item.png']
    template_image_book = ['book.png']
    start_time = time.monotonic()
    
    while True:
        if time.monotonic() - start_time > 90:
            break
            
        if time.monotonic() - start_time > 20:
            book_location = detect_image(template_image_book)
            if book_location is not None:
                click_element(book_location)
                time.sleep(random.uniform(0.029, 0.059))
                click_element(book_location)
                start_time = time.monotonic()
                continue
            
        while True:                
            time.sleep(random.uniform(0.006, 0.0095))
            spell_location = detect_image(template_image_spell)

            if spell_location is not None:
                click_element(spell_location)
                start_time = time.monotonic()
                break
            else:
                if time.monotonic() - start_time > 10:
                    break
                else:
                    continue
        
        while True:
            time.sleep(random.uniform(0.006, 0.0095))
            item_location = detect_image(template_image_item)

            if item_location is not None:
                click_element(item_location)
                start_time = time.monotonic()
                break
            else:
                if time.monotonic() - start_time > 10:
                    break
                else:
                    continue

if __name__ == "__main__":
    main()
</code></pre>
    </div>
<div>
<div>


</body>
</html>
































































































